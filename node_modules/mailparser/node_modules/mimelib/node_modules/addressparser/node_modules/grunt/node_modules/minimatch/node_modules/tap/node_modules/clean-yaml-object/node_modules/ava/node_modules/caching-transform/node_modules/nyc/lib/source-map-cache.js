var _ = require('lodash')
var path = require('path')
var convertSourceMap = require('convert-source-map')
var SourceMapConsumer = require('source-map').SourceMapConsumer

function SourceMapCache (opts) {
  _.extend(this, {
    cache: {},
    cwd: process.env.NYC_CWD || process.cwd()
  }, opts)
}

SourceMapCache.prototype.add = function (filename, source) {
  var sourceMap = convertSourceMap.fromSource(source) || convertSourceMap.fromMapFileSource(source, path.dirname(filename))
  if (sourceMap) this.cache['